<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>Gentoo 系统初探 - 北极狼徒</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
  
  <meta name="description" content="Table of Contens 安装准备 系统镜像 虚拟软件 启动系统 配置网络 准备磁盘 创建分区 创建文件系统 挂载根分区 安装 stage3 配置编译选项 基本系统 镜像站点 复制 DNS 信息 挂载必要的文">
  
  <meta itemprop="name" content="Gentoo 系统初探 - 北极狼徒">
  <meta itemprop="description" content="Table of Contens 安装准备 系统镜像 虚拟软件 启动系统 配置网络 准备磁盘 创建分区 创建文件系统 挂载根分区 安装 stage3 配置编译选项 基本系统 镜像站点 复制 DNS 信息 挂载必要的文">
  <meta itemprop="image" content="/img/author.jpg">
  
  
  <meta name="twitter:description" content="随便写写">
  
  <link rel="shortcut icon" href="/img/favicon.ico"/>
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
  <link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png" />
  <link rel="stylesheet" href="/highlight/styles/github.css">
  <script src="/highlight/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  
  <link rel="stylesheet" href="/font/hack/css/hack.min.css">
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <header>
    <div>
  
  <div id="imglogo">
    <a href="/"><img src="/img/logo.svg" alt="北极狼徒" title="北极狼徒"/></a>
  </div>
  
  <div id="textlogo">
    <h1 class="site-name"><a href="/" title="北极狼徒">北极狼徒</a></h1>
    <h2 class="blog-motto">个人博客</h2>
  </div>
  <div class="navbar"><a class="navbutton navmobile" href="#" title="menu"></a></div>
  <nav class="animated">
    <ul>
      
      <li><a href="/">首页</a></li>
      
      <li><a href="/about">关于</a></li>
      
      <li>
        <form class="search" method="get" action="https://www.google.com/search">
          <div>
            <input type="text" id="search" name="q" placeholder="搜索">
          </div>
        </form>
      </li>
    </ul>
  </nav>
</div>

  </header>
  <div id="container">
    <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody">
    <header class="article-info clearfix">
  <h1 itemprop="name">
      <a href="/post/gentoo_linux_first_try/" title="Gentoo 系统初探" itemprop="url">Gentoo 系统初探</a>
  </h1>
  <p class="article-author">By
    
      <a href="https://github.com/Jerling" title="[Jerling]">[Jerling]</a>
    
  </p>
  <p class="article-time">
    <time datetime="2018-12-22 00:00:00 &#43;0800 CST" itemprop="datePublished">2018年12月22日</time>
  </p>
</header>

	<div class="article-content">
    
    

<h2 id="table-of-contens">Table of Contens</h2>

<ul>
<li><a href="#安装准备">安装准备</a>

<ul>
<li><a href="#系统镜像">系统镜像</a></li>
<li><a href="#虚拟软件">虚拟软件</a></li>
<li><a href="#启动系统">启动系统</a></li>
</ul></li>
<li><a href="#配置网络">配置网络</a></li>
<li><a href="#准备磁盘">准备磁盘</a>

<ul>
<li><a href="#创建分区">创建分区</a></li>
<li><a href="#创建文件系统">创建文件系统</a></li>
<li><a href="#挂载根分区">挂载根分区</a></li>
</ul></li>
<li><a href="#安装-stage3">安装 stage3</a>

<ul>
<li><a href="#配置编译选项">配置编译选项</a></li>
</ul></li>
<li><a href="#基本系统">基本系统</a>

<ul>
<li><a href="#镜像站点">镜像站点</a></li>
<li><a href="#复制-dns-信息">复制 DNS 信息</a></li>
<li><a href="#挂载必要的文件系统">挂载必要的文件系统</a></li>
<li><a href="#进入新环境">进入新环境</a></li>
<li><a href="#挂载-boot-分区">挂载 boot 分区</a></li>
<li><a href="#选择配置文件">选择配置文件</a></li>
<li><a href="#更新-world-集合">更新 @world 集合</a></li>
<li><a href="#设置时区">设置时区</a></li>
<li><a href="#配置地区">配置地区</a></li>
</ul></li>
<li><a href="#编译内核">编译内核</a>

<ul>
<li><a href="#安装源码">安装源码</a></li>
<li><a href="#配置内核">配置内核</a></li>
<li><a href="#编译和安装内核">编译和安装内核</a></li>
</ul></li>
<li><a href="#配置系统">配置系统</a>

<ul>
<li><a href="#配置-fstab-文件">配置 fstab 文件</a></li>
<li><a href="#网络信息">网络信息</a></li>
</ul></li>
<li><a href="#系统工具">系统工具</a>

<ul>
<li><a href="#日志工具">日志工具</a></li>
<li><a href="#文件索引">文件索引</a></li>
<li><a href="#远程访问">远程访问</a></li>
<li><a href="#文件系统工具">文件系统工具</a></li>
<li><a href="#网络工具">网络工具</a></li>
</ul></li>
<li><a href="#安装引导">安装引导</a>

<ul>
<li><a href="#重启系统">重启系统</a></li>
</ul></li>
<li><a href="#后记">后记</a>

<ul>
<li><a href="#添加用户">添加用户</a></li>
<li><a href="#清理垃圾">清理垃圾</a></li>
</ul></li>
<li><a href="#总结">总结</a>

<ul>
<li><a href="#系统安装">系统安装</a></li>
<li><a href="#安装软件">安装软件</a></li>
</ul></li>
<li><a href="#参考链接">参考链接</a></li>
</ul>

<h2 id="安装准备">安装准备</h2>

<p><a href="https://www.gentoo.org/">Gentoo</a> 一直是一个特别的存在，号称极客系统。网上对其推(装)崇(逼)备(必)至(备)。作为一个爱装逼的骚年，自然是想一探究尽。关于它的介绍，这里就不说了，
因为想挑战它的 Geeker 肯定都知道，如果没听过，还是选择隔壁 <a href="https://www.manjaro.cn/">manjaro</a> 。manjaro 是基于另一个优秀的发行版 <a href="https://www.archlinux.org/">Arch Linux</a>，就是很贴心的省去了痛苦的
安装过程。想体验 Geeker 的成就感， Gentoo 和 Arch Linux 选择其中一个即可。这两者的区别是前者安装软件默认从源代码编译，而后者人性化一点，使用二进制安装包。
安装速度不知快了多少倍。也不知这些极客怎么忍受的，不过 Gentoo 的滚动更新没有 Arch 哪么快，所以安装完必要的软件之后就不须要频繁的更新，而 Arch 三天两头就可以
滚一滚了。</p>

<h3 id="系统镜像">系统镜像</h3>

<p>安装系统，镜像是必须的(废话)。去 <a href="https://www.gentoo.org/downloads/mirrors/">Gentoo官方镜像站</a> 下载的时候根据自己的硬件和地区选择合适的镜像，我这边使用的amd64的架构，
因此使用的是 releases/amd64/autobuilds/install-amd64-minimal-20181220T214503Z.iso。</p>

<h3 id="虚拟软件">虚拟软件</h3>

<p>这里以 VirtualBox 为例，VMware 应该是一样的。用VirtualBox的理由是便于端口转发，然后使用 putty 连接 LiveCD 系统，这样就没必要一个个的敲命令了。
当然这是最快体验大 Gentoo 的方法，如果要安装到物理机，除非另一个系统或电脑，否则只能一个个敲了。</p>

<h3 id="启动系统">启动系统</h3>

<p>这里参考网上创建虚拟机即可，启动的时候可以选择可用内核，本文用的是默认的4.14.83内核，快捷键： <code>F1</code> 显示可用内核； <code>F2</code> 显示可用的启动项。需要
详细参数的可以参考<a href="https://wiki.gentoo.org/wiki/Handbook:AMD64/Installation/Media/zh-cn">官方文档</a> 。
启动后，先设置 root 密码，便于ssh远程连接，然后开启 ssh 服务即可使用 ssh 客户端连接。</p>

<pre><code class="language-bash">root # passwd
New password: (Enter the new password)
Re-enter password: (Re-enter the password)

root # rc-service sshd start
</code></pre>

<p>如果是只有一台电脑安装，那么可以借助终端浏览器 <code>links2</code> 来实现查阅在线文档：</p>

<pre><code class="language-bash">root # links https://wiki.gentoo.org/wiki/Handbook:AMD64
</code></pre>

<h2 id="配置网络">配置网络</h2>

<p>这里我使用的 NAT 网络模式，内部系统默认使用的是 dhcp。反正是用来装系统的，所以能够联网就行，管它是不是静态ip呢。</p>

<h2 id="准备磁盘">准备磁盘</h2>

<h3 id="创建分区">创建分区</h3>

<p>分区表有 GPT 和 MBR 两种，前者是新的的分区格式，后者为比较老的。但是 GPT 要求主板支持 UEFI 启动，稍微有点麻烦。这个
麻烦主要体现在安装引导的地方，如果硬件不支持 UEFI ，那么引导是装不上去的。所以为了简单，本例以 MBR 为例。分区工具使用
fdisk，因为它是交互式的，命令也很简单。本例的最后的目标分区如下：</p>

<table>
<thead>
<tr>
<th>分区</th>
<th>描述</th>
</tr>
</thead>

<tbody>
<tr>
<td>/dev/sda1</td>
<td>BIOS启动分区</td>
</tr>

<tr>
<td>/dev/sda2</td>
<td>系统boot分区</td>
</tr>

<tr>
<td>/dev/sda3</td>
<td>交换分区</td>
</tr>

<tr>
<td>/dev/sda4</td>
<td>根分区</td>
</tr>
</tbody>
</table>

<pre><code class="language-bash">root # fdisk /dev/sda
  命令(输入 m 获取帮助)：m

  帮助：

    DOS (MBR)
     a   开关 可启动 标志
     b   编辑嵌套的 BSD 磁盘标签
     c   开关 dos 兼容性标志

    常规
     d   删除分区
     F   列出未分区的空闲区
     l   列出已知分区类型
     n   添加新分区
     p   打印分区表
     t   更改分区类型
     v   检查分区表
     i   打印某个分区的相关信息

    杂项
     m   打印此菜单
     u   更改 显示/记录 单位
     x   更多功能(仅限专业人员)

    脚本
     I   从 sfdisk 脚本文件加载磁盘布局
     O   将磁盘布局转储为 sfdisk 脚本文件

    保存并退出
     w   将分区表写入磁盘并退出
     q   退出而不保存更改

    新建空磁盘标签
     g   新建一份 GPT 分区表
     G   新建一份空 GPT (IRIX) 分区表
     o   新建一份的空 DOS 分区表
     s   新建一份空 Sun 分区表


  命令(输入 m 获取帮助)：
</code></pre>

<p>根据上面的提示就可以轻松的创建自己的分区，如果是新硬盘，须要先新建分区表。如果要创建
GPT 分区表，使用 <code>g</code> 命令， MBR 则使用 <code>o</code> 命令，然后就是创建分区了， <code>p</code> 可以显示分区
信息， <code>n</code> 用于添加新分区，按照提示给定分区大小。这里值得一提的是 MBR 只能有 <code>4</code> 个主分区。
如果想多于 <code>4</code> 个，应将其中一个设置为扩展分区。本例最后的分区结果如下：</p>

<pre><code class="language-bash">命令(输入 m 获取帮助)：p
Disk /dev/sda：59.1 GiB，63433342976 字节，123893248 个扇区
单元：扇区 / 1 * 512 = 512 字节
扇区大小(逻辑/物理)：512 字节 / 512 字节
I/O 大小(最小/最佳)：512 字节 / 512 字节
磁盘标签类型：dos
磁盘标识符：0x158b7a45

设备       启动    起点      末尾      扇区  大小 Id 类型
/dev/sda1          2048      6143      4096    2M 83 Linux
/dev/sda2          6144    268287    262144  128M 83 Linux
/dev/sda3        268288   1316863   1048576  512M 83 Linux
/dev/sda4       1316864 123893247 122576384 58.5G 83 Linux

命令(输入 m 获取帮助)：
</code></pre>

<h3 id="创建文件系统">创建文件系统</h3>

<p>BIOS分区可以不用管，只要创建其分区的文件系统即可：</p>

<pre><code class="language-bash">root # mkfs.ext2 /dev/sda2
root # mkfs.ext4 /dev/sda4
root # mkswap /dev/sda3
root # swapon /dev/sda3
</code></pre>

<h3 id="挂载根分区">挂载根分区</h3>

<p>现在把根区挂载到 liveCD 上，这样才能使用该分区来安装系统。</p>

<pre><code class="language-bash">root # mount /dev/sda4 /mnt/gentoo
</code></pre>

<h2 id="安装-stage3">安装 stage3</h2>

<p>在下载系统镜像的地址有对应的 stage3 的镜像，把它下载下来并解压到 /mnt/gentoo 目录。
在下载之前先确定一下系统的时间, 如果不对则设置时间，否则安下载 stage3 会报错：</p>

<pre><code class="language-bash">root # date
2018年 12月 25日 星期二 20:36:02 CST
root # date 122520362018  # 如果不是就设置
</code></pre>

<pre><code class="language-bash">root # cd /mnt/gentoo
root # wget https://mirrors.tuna.tsinghua.edu.cn/gentoo/releases/amd64/autobuilds/current-stage3-amd64/stage3-x32-20181220T214503Z.tar.xz
root # tar xvJf stage3-x32-20181220T214503Z.tar.xz
</code></pre>

<h3 id="配置编译选项">配置编译选项</h3>

<p>这里基本是用的默认选项，只增加了 make 的编译线程，据说线程数为 CPU 核心数的 2 倍的时候
编译效果最佳。吐嘈一下，镜像里竟然不带vi。</p>

<pre><code class="language-bash">root #nano -w /mnt/gentoo/etc/portage/make.conf
MAKEOPTS=&quot;-j2&quot;
</code></pre>

<h2 id="基本系统">基本系统</h2>

<p>现在就需要配置需要编译的模块了，各取所需了，想想这应该是极客比较喜欢
它的理由吧，小而强悍，没必要添加不需要的模块。</p>

<h3 id="镜像站点">镜像站点</h3>

<p>虽然是可选操作，但是为了速度，选择国内站点是个明智的选择，选完站点后，需要配置 Gentoo ebuild
软件仓库。</p>

<pre><code class="language-bash">root #mirrorselect -i -o &gt;&gt; /mnt/gentoo/etc/portage/make.conf
root #mkdir --parents /mnt/gentoo/etc/portage/repos.conf
root #cp /mnt/gentoo/usr/share/portage/config/repos.conf /mnt/gentoo/etc/portage/repos.conf/gentoo.conf
</code></pre>

<h3 id="复制-dns-信息">复制 DNS 信息</h3>

<p>便于进入到里面的系统联网，需要复制 DNS 信息。</p>

<pre><code class="language-bash">cp --dereference /etc/resolv.conf /mnt/gentoo/etc/
</code></pre>

<h3 id="挂载必要的文件系统">挂载必要的文件系统</h3>

<p>等会儿Linux的根将变更到新的位置。为了确保新环境正常工作，需要确保一些文件系统可以正常使用。</p>

<p>需要提供的文件系统是：</p>

<ul>
<li>/proc : 一个pseudo文件系统（看起来像是常规文件，事实上却是实时生成的），由Linux内核暴露的一些环境信息</li>
<li>_sys :  一个pseudo文件系统，像要被取代的/proc_一样，比_proc_更加有结构</li>
<li>/dev : 是一个包含全部设备文件的常规文件系统，一部分由Linux设备管理器（通常是udev）管理</li>
</ul>

<p>_proc_位置将要挂载到_mnt/gentoo/proc_，而其它的两个都是绑定挂载。字面上的意思是，例如_mnt/gentoo/sys_事实上就是_sys_（它只是同一个文件系统的第二个条目点），而_mnt/gentoo/proc_是（可以说是）文件系统的一个新的挂载。</p>

<pre><code class="language-bash">root #mount --types proc /proc /mnt/gentoo/proc
root #mount --rbind /sys /mnt/gentoo/sys
root #mount --make-rslave /mnt/gentoo/sys
root #mount --rbind /dev /mnt/gentoo/dev
root #mount --make-rslave /mnt/gentoo/dev
</code></pre>

<h3 id="进入新环境">进入新环境</h3>

<p>只需使用 chroot 命令即可进入新系统，当然还有一些必要的环境切换，如加载新环境的环境变量以及
修改提示符用来区分系统。</p>

<pre><code class="language-bash">root #chroot /mnt/gentoo /bin/bash
root #source /etc/profile
root #export PS1=&quot;(chroot) ${PS1}&quot;
</code></pre>

<h3 id="挂载-boot-分区">挂载 boot 分区</h3>

<p>这一步很重要，当编译内核并安装引导加载程序时会放在 boot 里。</p>

<pre><code class="language-bash">root #mount /dev/sda2 /boot
</code></pre>

<h3 id="选择配置文件">选择配置文件</h3>

<p>配置文件会决定你想要安装什么软件，所以这个也会决定编译时间的长短，为了快速体验 Gentoo，本例
使用了默认的选项，没有桌面环境以及 systemd 等。</p>

<pre><code class="language-bash">root #eselect profile list

Available profile symlink targets:
  [1]   default/linux/amd64/13.0 *
  [2]   default/linux/amd64/13.0/desktop
  [3]   default/linux/amd64/13.0/desktop/gnome
  [4]   default/linux/amd64/13.0/desktop/kde
  [5]   default/linux/amd64/13.0/desktop/gnome/systemd (stable)
  [6]   default/linux/amd64/13.0/desktop/plasma (stable)
  [7]   default/linux/amd64/13.0/desktop/plasma/systemd (stable)
  [8]   default/linux/amd64/13.0/developer (stable)
  [9]   default/linux/amd64/13.0/no-multilib (stable)
  [10]  default/linux/amd64/13.0/systemd (stable)
  [11]  default/linux/amd64/13.0/x32 (dev)
  [12]  default/linux/amd64/17.0 (stable) *
  [13]  default/linux/amd64/17.0/selinux (stable)
  [14]  default/linux/amd64/17.0/hardened (stable)
  [15]  default/linux/amd64/17.0/hardened/selinux (stable)
  [16]  default/linux/amd64/17.0/desktop (stable)
  [17]  default/linux/amd64/17.0/desktop/gnome (stable)
  [18]  default/linux/amd64/17.0/desktop/gnome/systemd (stable)
  [19]  default/linux/amd64/17.0/desktop/plasma (stable)
  [20]  default/linux/amd64/17.0/desktop/plasma/systemd (stable)
  [21]  default/linux/amd64/17.0/developer (stable)
  [22]  default/linux/amd64/17.0/no-multilib (stable)
  [23]  default/linux/amd64/17.0/no-multilib/hardened (stable)
  [24]  default/linux/amd64/17.0/no-multilib/hardened/selinux (stable)
  [25]  default/linux/amd64/17.0/systemd (stable)
  [26]  default/linux/amd64/17.0/x32 (dev)
</code></pre>

<p>如果想选择其他的配置，比如想使用17.0版本的 gnome 桌面，则使用如下命令选择即可：</p>

<pre><code class="language-bash">root # eselect profile set 17
</code></pre>

<h3 id="更新-world-集合">更新 @world 集合</h3>

<p>当系统应用了任何的升级，或从任何 profile 构建了 stage3 后，应用了变化的 use 标记时，
都需要更新一下 <code>@world</code> :</p>

<pre><code class="language-bash">root #emerge --ask --verbose --update --deep --newuse @world
</code></pre>

<h3 id="设置时区">设置时区</h3>

<p>为系统选择时区。在_usr/share/zoneinfo_中查找可用的时区，然后写进/etc/timezone文件。</p>

<pre><code class="language-bash">root # ls /usr/share/zoneinfo
root #echo &quot;Asia/Shanghai&quot; &gt; /etc/timezone
</code></pre>

<p>安装 <a href="https://packages.gentoo.org/packages/sys-libs/timezone-data">sys-libs/timezone-data</a> 自动更新 <code>/etc/localtime</code> 文件。该文件用于让系统的 C 类库知道
系统在什么时区。</p>

<pre><code class="language-bash">root #emerge --config sys-libs/timezone-data
</code></pre>

<h3 id="配置地区">配置地区</h3>

<pre><code class="language-bash">root #nano -w /etc/locale.gen

# 将下面的文本加入文件中
en_US ISO-8859-1
en_US.UTF-8 UTF-8
zh_CN GBK
zh_CN.UTF-8 UTF-8
</code></pre>

<p>使设置生效，运行命令： <code>locale-gen</code> 。最后选择默认字体:</p>

<pre><code class="language-bash">root #eselect locale list

Available targets for the LANG variable:
  [1]   C
  [2]   en_US
  [3]   en_US.iso88591
  [4]   en_US.utf8
  [5]   POSIX
  [6]   zh_CN
  [7]   zh_CN.gbk
  [8]   zh_CN.utf8
  [ ]   (free form)
root #eselect locale set 8
</code></pre>

<p>重新加载环境：</p>

<pre><code class="language-bash">root #env-update &amp;&amp; source /etc/profile &amp;&amp; export PS1=&quot;(chroot) $PS1&quot;
</code></pre>

<h2 id="编译内核">编译内核</h2>

<p>前期的准备基本已经完成，终于要上主菜了。</p>

<h3 id="安装源码">安装源码</h3>

<p>这里使用 gentoo-source 包来安装内核。安装完就可以在 <code>/usr/src/linux</code> 找到对应的源码了。</p>

<pre><code class="language-bash">root #emerge --ask sys-kernel/gentoo-sources
root #ls -l /usr/src/linux

lrwxrwxrwx    1 root   root    12 Oct 13 11:04 /usr/src/linux -&gt; linux-3.16.5-gentoo
</code></pre>

<h3 id="配置内核">配置内核</h3>

<p>首先要知道自己的硬件配置，这样才能配置对应的内核，查看硬件信息需要借助 <code>lspci</code> 命令。
因此需要先安装对应的工具：</p>

<pre><code class="language-bash">root #emerge --ask sys-apps/pciutils
</code></pre>

<p>在了解了自己的硬件配置之后，就可以进行配置了，官网提供了两种方法，第二种是自动化，本来想偷个
懒使用 genkernel 软件省去自己手动配置的烦恼。可惜事与愿违，这个软件死活装不上去，只能手动配置了。
还好大部分的配置都选好了，这里只增加了32位的软件支持：</p>

<pre><code class="language-bash">Executable file formats / Emulations  ---&gt;
   [*] IA32 Emulation
</code></pre>

<p>当然如果是 UEFI ，就需要增加一些配置，不然没法驱动。传送门：<a href="https://wiki.gentoo.org/wiki/Handbook:AMD64/Installation/Kernel/zh-cn">https://wiki.gentoo.org/wiki/Handbook:AMD64/Installation/Kernel/zh-cn</a></p>

<p>记得保存配置。。。</p>

<h3 id="编译和安装内核">编译和安装内核</h3>

<p>这个步骤就比较慢了，估计半个多小时吧，可以泡杯咖啡慢慢等了。</p>

<pre><code class="language-bash">root # make &amp;&amp; make modules_install &amp;&amp; make install
</code></pre>

<h2 id="配置系统">配置系统</h2>

<p>如果上面的步骤没有报错，那么恭喜你，你离成功只有一步之遥了。</p>

<h3 id="配置-fstab-文件">配置 fstab 文件</h3>

<p>这是系统所有分区挂载的文件。引用官网的一段介绍：</p>

<blockquote>
<p>/etc/fstab文件使用一种特殊语法格式。每行都包含六个字段。这些字段之间由空白键（空格键，
tab键，或者两者混合使用）分隔。每个字段都有自己的含意：</p>

<ol>
<li><code>＃</code> 第一个字段显示要挂载的特殊 block 设备或远程文件系统。 有几种设备标识符可用于特殊块设备节点，</li>
</ol>

<p>包括设备文件路径，文件系统标签，UUID，分区标签以及UUID。</p>

<ol>
<li>第二个字段是分区挂载点，也就是分区应该挂载到的地方</li>
<li>第三个字段给出分区所用的文件系统</li>
<li>第四个字段给出的是挂载分区时mount命令所用的挂载选项。由于每个文件系统都有自己的挂载选项。</li>
<li>第五个字段是给dump使用的，用以决定这个分区是否需要dump。一般情况下，你可以把该字段设为0（零）。</li>
<li>第六个字段是给fsck使用的，用以决定系统非正常关机之后文件系统的检查顺序。</li>
</ol>

<p>根文件系统应该为1，而其它的应该为2（如果不需要文件系统自检的话可以设为0）</p>
</blockquote>

<pre><code class="language-bash">root # nano -w /etc/fstab

# 将下面的内容拷贝到 fstab 中
/dev/sda2   /boot        ext2    defaults,noatime     0 2
/dev/sda3   none         swap    sw                   0 0
/dev/sda4   /            ext4    noatime              0 1

/dev/cdrom  /mnt/cdrom   auto    noauto,user          0 0
</code></pre>

<h3 id="网络信息">网络信息</h3>

<h4 id="主机名">主机名</h4>

<pre><code class="language-bash">root # echo 'hostname=&quot;Gentoo&quot;' &gt; /etc/conf.d/hostname
</code></pre>

<h4 id="配置网络-1">配置网络</h4>

<p>这里使用的 DHCP 自动获取 IP:</p>

<pre><code class="language-bash">root # echo 'config_enp0s3=&quot;dhcp&quot;' &gt; /etc/conf.d/net
</code></pre>

<p>当然也可以使用静态 ip :</p>

<pre><code class="language-bash"># /etc/conf.d/net静态IP定义
config_enp0s3=&quot;192.168.0.2 netmask 255.255.255.0 brd 192.168.0.255&quot;
routes_enp0s3=&quot;default via 192.168.0.1&quot;
</code></pre>

<p>设置开机启动网络：</p>

<pre><code class="language-bash">root #cd /etc/init.d
root #ln -s net.lo net.enp0s3
root #rc-update add net.enp0s3 default
</code></pre>

<h4 id="root-密码">Root 密码</h4>

<p>这个前面已经介绍过了，千万别忘记。</p>

<h2 id="系统工具">系统工具</h2>

<p>现在只需要安装必要的系统软件即可。</p>

<h3 id="日志工具">日志工具</h3>

<pre><code class="language-bash">root #emerge --ask app-admin/sysklogd
root #rc-update add sysklogd default
</code></pre>

<h3 id="文件索引">文件索引</h3>

<pre><code class="language-bash">root #emerge --ask sys-apps/mlocate
</code></pre>

<h3 id="远程访问">远程访问</h3>

<pre><code class="language-bash">rc-update add sshd default
</code></pre>

<h3 id="文件系统工具">文件系统工具</h3>

<p>系统已经自带了 ext 文件系统的工具，需要其它文件系统需要自行安装。</p>

<table>
<thead>
<tr>
<th>Filesystem</th>
<th>Package</th>
</tr>
</thead>

<tbody>
<tr>
<td>Ext2, 3, and 4</td>
<td>sys-fs/e2fsprogs</td>
</tr>

<tr>
<td>XFS</td>
<td>sys-fs/xfsprogs</td>
</tr>

<tr>
<td>ReiserFS</td>
<td>sys-fs/reiserfsprogs</td>
</tr>

<tr>
<td>JFS</td>
<td>sys-fs/jfsutils</td>
</tr>

<tr>
<td>VFAT (FAT32, &hellip;)</td>
<td>sys-fs/dosfstools</td>
</tr>

<tr>
<td>Btrfs</td>
<td>sys-fs/btrfs-progs</td>
</tr>
</tbody>
</table>

<h3 id="网络工具">网络工具</h3>

<p>因为系统不带 dhcp 客户端，需要自己安装，Gentoo 为了保持干净也是拼了。</p>

<pre><code class="language-bash">root #emerge --ask net-misc/dhcpcd
</code></pre>

<h2 id="安装引导">安装引导</h2>

<p>最后一关到了，成功与否就看它了。不过如果使用 MBR 分区表就没必要担心了。
这一步主要难在要支持 UEFI 启动，这个是比较麻烦的，也许是我搭的虚拟机的硬件不
支持 UEFI，所以第一次配置到这里的时候以失败告终。所以换了 MBR 后，一步成功。</p>

<pre><code class="language-bash">root # emerge --ask --verbose sys-boot/grub:2
root # grub-install /dev/sda
root # grub-mkconfig -o /boot/grub/grub.cfg
</code></pre>

<h3 id="重启系统">重启系统</h3>

<p>OK，彻底结束了，重启之后就可以享(折)受(腾) Gentoo 了。</p>

<pre><code class="language-bash">root #exit
livecd ~# cd
livecd ~# umount -l /mnt/gentoo/dev{/shm,/pts,}
livecd ~# umount -R /mnt/gentoo
livecd ~# reboot
</code></pre>

<h2 id="后记">后记</h2>

<p>如果启动成功，那么就可以开心的使用它了，首先要建立一个普通用户，避免权限过大
损坏系统。</p>

<h3 id="添加用户">添加用户</h3>

<table>
<thead>
<tr>
<th>Group</th>
<th>Description</th>
</tr>
</thead>

<tbody>
<tr>
<td>audio</td>
<td>允许使用声音设备</td>
</tr>

<tr>
<td>cdrom</td>
<td>允许直接使用光驱设备</td>
</tr>

<tr>
<td>floppy</td>
<td>允许直接使用软驱</td>
</tr>

<tr>
<td>games</td>
<td>允许运行游戏</td>
</tr>

<tr>
<td>portage</td>
<td>能够访问portage受限资源。</td>
</tr>

<tr>
<td>usb</td>
<td>允许使用USB设备</td>
</tr>

<tr>
<td>video</td>
<td>允许使用视频采集设备和硬件加速</td>
</tr>

<tr>
<td>wheel</td>
<td>可以使用su.</td>
</tr>
</tbody>
</table>

<pre><code class="language-bash">root #useradd -m -G users,wheel,audio -s /bin/bash jer
root #passwd jer
</code></pre>

<h3 id="清理垃圾">清理垃圾</h3>

<pre><code class="language-bash">root #rm /stage3-*.tar.bz2*
</code></pre>

<h2 id="总结">总结</h2>

<h3 id="系统安装">系统安装</h3>

<p>很早就听说 Gentoo 系统，只是怕麻烦，懒得去安装。昨天突然心血来潮，就装了一下试试。
总的来说和 Arch 安装过程差不多，不过这编译速度太感人了， Arch 下载基本系统也就十来分钟
吧，源比较快可能几分钟就搞定了，而 Gentoo 光是编译内核就需要半个小时以上。</p>

<h3 id="安装软件">安装软件</h3>

<p>常用的软件使用以及建议，vim 和 emacs 这两大编译器最好自己去安防网下载源码自行编译，
因为emerge安装的是腌割版。至于 nodejs (hexo) 需要，因为依赖的软件太多了，所以要一个个
安装完再安装 nodejs，而且如果有提示版本不一致的，需要卸载再装。目前还在探索中。。。
如果要使用 emerge 安装软件，而又记不得软件名使用 <code>-s</code> 参数查询软件，然后选择合适的版本进行安装。
这里提一最好用正则表达式搜索，不然可能会搜到好多软件。</p>

<p>给出vim 和 emacs 的编译选项，免得再找：</p>

<ul>
<li><p>vim : ./configure  &ndash;enable-pythoninterp=yes &ndash;with-python-config-dir=/usr/lib64/python3.6/config &ndash;enable-cscope</p></li>

<li><p>emacs: ./configure &ndash;with-pop &ndash;with-mailutils</p></li>

<li><p>nodejs:</p>

<pre><code class="language-bash">  sudo emerge net-libs/http-parser
  sudo emerge dev-util/boost-build
  sudo emerge  dev-libs/boost
  sudo emerge  dev-libs/libuv
  sudo emerge --unmerge dev-libs/openssl
  sudo emerge dev-libs/openssl
  sudo emerge net-libs/nghttp2
  sudo emerge net-libs/nodejs
</code></pre>

<h2 id="参考链接">参考链接</h2>

<p><a href="https://wiki.gentoo.org/wiki/Handbook:AMD64/Full/Installation/zh-cn">https://wiki.gentoo.org/wiki/Handbook:AMD64/Full/Installation/zh-cn</a></p></li>
</ul>

    
	</div>
  <footer class="article-footer clearfix">
  

<div class="article-tags">
  <span></span>
  
  <a href="/tags/linux">linux</a>
  
  <a href="/tags/gentoo">gentoo</a>
  
  <a href="/tags/funny">funny</a>
  
</div>





<div class="article-categories">
  <span></span>
  
  <a class="article-category-link" href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F">操作系统</a>
  
</div>



  <div class="article-share" id="share">
    <div data-url="/post/gentoo_linux_first_try/" data-title="Gentoo 系统初探" data-tsina="123" class="share clearfix">
    </div>
  </div>
</footer>

	</article>
  



</div>

    <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>
<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">
  

<div class="categorieslist">
  <p class="asidetitle">分类</p>
  <ul>
    
    <li><a href="/categories/%e5%86%85%e5%ad%98%e7%ae%a1%e7%90%86" title="内存管理">内存管理<sup>1</sup></a></li>
    
    <li><a href="/categories/%e5%91%bd%e4%bb%a4%e8%a1%8c%e8%89%ba%e6%9c%af" title="命令行艺术">命令行艺术<sup>3</sup></a></li>
    
    <li><a href="/categories/%e5%ad%a6%e4%b9%a0%e7%ac%94%e8%ae%b0" title="学习笔记">学习笔记<sup>7</sup></a></li>
    
    <li><a href="/categories/%e6%93%8d%e4%bd%9c%e7%b3%bb%e7%bb%9f" title="操作系统">操作系统<sup>1</sup></a></li>
    
    <li><a href="/categories/%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84" title="数据结构">数据结构<sup>1</sup></a></li>
    
    <li><a href="/categories/%e6%b8%a9%e6%95%85%e7%9f%a5%e6%96%b0" title="温故知新">温故知新<sup>1</sup></a></li>
    
    <li><a href="/categories/%e9%a1%b9%e7%9b%ae%e5%ae%9e%e6%88%98" title="项目实战">项目实战<sup>5</sup></a></li>
    
  </ul>
</div>



  

<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
      
			<li><a href="/tags/c&#43;&#43;" title="c&#43;&#43;">c&#43;&#43;<sup>10</sup></a></li>
      
			<li><a href="/tags/command" title="command">command<sup>3</sup></a></li>
      
			<li><a href="/tags/conclusion" title="conclusion">conclusion<sup>1</sup></a></li>
      
			<li><a href="/tags/data_struct" title="data_struct">data_struct<sup>1</sup></a></li>
      
			<li><a href="/tags/funny" title="funny">funny<sup>1</sup></a></li>
      
			<li><a href="/tags/gentoo" title="gentoo">gentoo<sup>1</sup></a></li>
      
			<li><a href="/tags/jemalloc" title="jemalloc">jemalloc<sup>1</sup></a></li>
      
			<li><a href="/tags/kernel" title="kernel">kernel<sup>2</sup></a></li>
      
			<li><a href="/tags/linux" title="linux">linux<sup>6</sup></a></li>
      
			<li><a href="/tags/linux%e5%86%85%e6%a0%b8" title="linux内核">linux内核<sup>1</sup></a></li>
      
			<li><a href="/tags/pmalloc2" title="pmalloc2">pmalloc2<sup>1</sup></a></li>
      
			<li><a href="/tags/shell" title="shell">shell<sup>4</sup></a></li>
      
			<li><a href="/tags/tcmalloc" title="tcmalloc">tcmalloc<sup>1</sup></a></li>
      
			<li><a href="/tags/terminal" title="terminal">terminal<sup>5</sup></a></li>
      
			<li><a href="/tags/text_editor" title="text_editor">text_editor<sup>1</sup></a></li>
      
			<li><a href="/tags/textor" title="textor">textor<sup>3</sup></a></li>
      
			<li><a href="/tags/tree" title="tree">tree<sup>1</sup></a></li>
      
			<li><a href="/tags/%e5%af%b9%e8%b1%a1%e6%a8%a1%e5%9e%8b" title="对象模型">对象模型<sup>3</sup></a></li>
      
			<li><a href="/tags/%e6%88%90%e5%91%98%e5%87%bd%e6%95%b0" title="成员函数">成员函数<sup>1</sup></a></li>
      
			<li><a href="/tags/%e7%b3%bb%e7%bb%9f%e8%b0%83%e7%94%a8" title="系统调用">系统调用<sup>1</sup></a></li>
      
			<li><a href="/tags/%e7%bb%a7%e6%89%bf" title="继承">继承<sup>1</sup></a></li>
      
			<li><a href="/tags/%e7%bc%96%e7%a8%8b%e8%af%ad%e8%a8%80" title="编程语言">编程语言<sup>3</sup></a></li>
      
			<li><a href="/tags/%e8%bf%9b%e7%a8%8b%e7%ae%a1%e7%90%86" title="进程管理">进程管理<sup>1</sup></a></li>
      
			<li><a href="/tags/%e8%bf%9b%e7%a8%8b%e8%b0%83%e5%ba%a6" title="进程调度">进程调度<sup>1</sup></a></li>
      
			<li><a href="/tags/%e9%9d%a2%e5%90%91%e5%af%b9%e8%b1%a1" title="面向对象">面向对象<sup>2</sup></a></li>
      
		</ul>
</div>



  
  <div class="archiveslist">
    <p class="asidetitle">归档</p>
    <ul class="archive-list">
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="/post/#2019-06">2019年06月</a><span class="archive-list-count">2</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="/post/#2019-05">2019年05月</a><span class="archive-list-count">5</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="/post/#2019-04">2019年04月</a><span class="archive-list-count">1</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="/post/#2019-03">2019年03月</a><span class="archive-list-count">2</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="/post/#2019-02">2019年02月</a><span class="archive-list-count">4</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="/post/#2019-01">2019年01月</a><span class="archive-list-count">4</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="/post/#2018-12">2018年12月</a><span class="archive-list-count">1</span>
      </li>
      
    </ul>

  </div>


  

<div class="tagcloudlist">
  <p class="asidetitle">标签云</p>
  <div class="tagcloudlist clearfix">
    
    <a href="/tags/c&#43;&#43;" style="font-size: 12px;">c&#43;&#43;</a>
    
    <a href="/tags/command" style="font-size: 12px;">command</a>
    
    <a href="/tags/conclusion" style="font-size: 12px;">conclusion</a>
    
    <a href="/tags/data_struct" style="font-size: 12px;">data_struct</a>
    
    <a href="/tags/funny" style="font-size: 12px;">funny</a>
    
    <a href="/tags/gentoo" style="font-size: 12px;">gentoo</a>
    
    <a href="/tags/jemalloc" style="font-size: 12px;">jemalloc</a>
    
    <a href="/tags/kernel" style="font-size: 12px;">kernel</a>
    
    <a href="/tags/linux" style="font-size: 12px;">linux</a>
    
    <a href="/tags/linux%e5%86%85%e6%a0%b8" style="font-size: 12px;">linux内核</a>
    
    <a href="/tags/pmalloc2" style="font-size: 12px;">pmalloc2</a>
    
    <a href="/tags/shell" style="font-size: 12px;">shell</a>
    
    <a href="/tags/tcmalloc" style="font-size: 12px;">tcmalloc</a>
    
    <a href="/tags/terminal" style="font-size: 12px;">terminal</a>
    
    <a href="/tags/text_editor" style="font-size: 12px;">text_editor</a>
    
    <a href="/tags/textor" style="font-size: 12px;">textor</a>
    
    <a href="/tags/tree" style="font-size: 12px;">tree</a>
    
    <a href="/tags/%e5%af%b9%e8%b1%a1%e6%a8%a1%e5%9e%8b" style="font-size: 12px;">对象模型</a>
    
    <a href="/tags/%e6%88%90%e5%91%98%e5%87%bd%e6%95%b0" style="font-size: 12px;">成员函数</a>
    
    <a href="/tags/%e7%b3%bb%e7%bb%9f%e8%b0%83%e7%94%a8" style="font-size: 12px;">系统调用</a>
    
    <a href="/tags/%e7%bb%a7%e6%89%bf" style="font-size: 12px;">继承</a>
    
    <a href="/tags/%e7%bc%96%e7%a8%8b%e8%af%ad%e8%a8%80" style="font-size: 12px;">编程语言</a>
    
    <a href="/tags/%e8%bf%9b%e7%a8%8b%e7%ae%a1%e7%90%86" style="font-size: 12px;">进程管理</a>
    
    <a href="/tags/%e8%bf%9b%e7%a8%8b%e8%b0%83%e5%ba%a6" style="font-size: 12px;">进程调度</a>
    
    <a href="/tags/%e9%9d%a2%e5%90%91%e5%af%b9%e8%b1%a1" style="font-size: 12px;">面向对象</a>
    
  </div>
</div>



  

</aside>
</div>

  </div>
  <footer><div id="footer" >
  
  <div class="line">
    <span></span>
    <div style='background:no-repeat url("/img/author.jpg") left top;-webkit-background-size:6.875em 6.875em;-moz-background-size:6.875em 6.875em;background-size:6.875em 6.875em;' class="author" ></div>
  </div>
  
  
  <section class="info">
    <p>码农一枚 <br/> 混口饭吃</p>
  </section>
  
  <div class="social-font clearfix">
    
    
    
    <a href="https://github.com/Jerling" target="_blank" title="github"></a>
    
    
    
  </div>
  <p class="copyright">Powered by <a href="http://gohugo.io" target="_blank" title="hugo">hugo</a> and Theme by <a href="https://github.com/coderzh/hugo-pacman-theme" target="_blank" title="hugo-pacman-theme">hugo-pacman-theme</a> © 2019
    
    <a href="/" title="北极狼徒">北极狼徒</a>
    
  </p>
</div>
</footer>
  <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
done = false;
$(document).ready(function(){
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize();
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  $('form.search').on('submit', function (event) {
    if (false === done) {
      event.preventDefault();
      var orgVal = $(this).find('#search').val();
      $(this).find('#search').val('site:\/ ' + orgVal);
      done = true;
      $(this).submit();
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>

<script type="text/javascript">
$(document).ready(function(){
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://b.bshare.cn/barCode?site=weixin&url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});
</script>


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
});
</script>




</body>
</html>
