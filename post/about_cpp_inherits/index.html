<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="pinterest" content="nopin">
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<meta name="generator" content="Hugo 0.54.0" />



<link rel="canonical" href="/post/about_cpp_inherits/">


    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/solarized_dark.min.css">
    <title>关于对象那些事儿 ~~ 继承 - 北极狼徒</title>
    
<meta name="description" content="对 C&#43;&#43; 继承的一些理解">

<meta property="og:title" content="关于对象那些事儿 ~~ 继承 - 北极狼徒">
<meta property="og:type" content="article">
<meta property="og:url" content="/post/about_cpp_inherits/">
<meta property="og:image" content="/images/default.png">
<meta property="og:site_name" content="北极狼徒">
<meta property="og:description" content="对 C&#43;&#43; 继承的一些理解">
<meta property="og:locale" content="ja_JP">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="北极狼徒">
<meta name="twitter:url" content="/post/about_cpp_inherits/">
<meta name="twitter:title" content="关于对象那些事儿 ~~ 继承 - 北极狼徒">
<meta name="twitter:description" content="对 C&#43;&#43; 继承的一些理解">
<meta name="twitter:image" content="/images/default.png">


<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "NewsArticle",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id":"/"
    },
    "headline": "关于对象那些事儿 ~~ 继承 - 北极狼徒",
    "image": {
      "@type": "ImageObject",
      "url": "/images/default.png",
      "height": 800,
      "width": 800
    },
    "datePublished": "2019-02-22T20:07:56JST",
    "dateModified": "2019-02-24T12:02:55JST",
    "author": {
      "@type": "Person",
      "name": "北极狼徒"
    },
    "publisher": {
      "@type": "Organization",
      "name": "北极狼徒",
      "logo": {
        "@type": "ImageObject",
        "url": "/images/logo.png",
        "width": 600,
        "height": 60
      }
    },
    "description": "对 C&#43;&#43; 继承的一些理解"
  }
</script>


    <link href="/css/styles.css" rel="stylesheet">
    

  </head>

  <body>
    
    
    

    <header class="l-header">
      <nav class="navbar navbar-default">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">北极狼徒</a>
          </div>

          
          <div id="navbar" class="collapse navbar-collapse">
            
            <ul class="nav navbar-nav navbar-right">
              
              
              <li><a href="/">Home</a></li>
              
              
              
              <li><a href="/post/">Blog</a></li>
              
              
              
              <li><a href="/categories/">Categories</a></li>
              
              
              
              <li><a href="/tags/">Tags</a></li>
              
              
              
              <li><a href="/about/">About</a></li>
              
              
              
              <li><a href="/itemized/">Itemized</a></li>
              
              
            </ul>
            
          </div>
          

        </div>
      </nav>
    </header>

    <main>
      <div class="container">
        
<div class="row">
  <div class="col-md-8">

    <nav class="p-crumb">
      <ol class="breadcrumb">
        <li><a href="/"><i class="fa fa-home" aria-hidden="true"></i></a></li>
        
        <li itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb"><a href="/post/" itemprop="url"><span itemprop="title">post</span></a></li>
        
        <li class="active">关于对象那些事儿 ~~ 继承</li>
      </ol>
    </nav>

    <article class="single">
  <header>
    <ul class="p-facts">
      <li><i class="fa fa-calendar" aria-hidden="true"></i><time datetime="2019-02-24T12:02:55JST">Feb 24, 2019</time></li>
      <li><i class="fa fa-bookmark" aria-hidden="true"></i><a href="/post/">post</a></li>
      
    </ul>

    <h1 class="title">关于对象那些事儿 ~~ 继承</h1>
  </header>

  

  <div class="article-body">

<h2 id="table-of-contens">Table of Contens</h2>

<ul>
<li><a href="#关于继承">关于继承</a>

<ul>
<li><a href="#何为对象">何为对象</a></li>
<li><a href="#何为继承">何为继承</a></li>
</ul></li>
<li><a href="#public-继承">public 继承</a>

<ul>
<li><a href="#public-继承权限">public 继承权限</a></li>
<li><a href="#实例">实例</a></li>
</ul></li>
<li><a href="#protected-继承">protected 继承</a>

<ul>
<li><a href="#protected-继承权限">protected 继承权限</a></li>
<li><a href="#实例">实例</a></li>
</ul></li>
<li><a href="#private-继承">private 继承</a>

<ul>
<li><a href="#protected-继承权限">protected 继承权限</a></li>
<li><a href="#实例">实例</a></li>
</ul></li>
<li><a href="#虚继承">虚继承</a>

<ul>
<li><a href="#实例">实例</a></li>
<li><a href="#虚继承与虚函数">虚继承与虚函数</a></li>
</ul></li>
<li><a href="#总结">总结</a></li>
</ul>

<h2 id="关于继承">关于继承</h2>

<p>随着软件功能的日益完善，随之而来的就是软件的也越来越大，变得难以维护。传统的面向
过程的编程范式难以满足日益丰富的用户需求，因此需要一种新的编程范式来应对这种
复杂的需求。面向对象在这个时候出现，很好的解决了这些难题。它是一种软件开发方法，
利用对世界关系的分析方法来分析复杂软件体系关系，实践证明这是可行的。</p>

<h3 id="何为对象">何为对象</h3>

<p>世界的所有事物都可以抽象为一个对象，一个对象拥有基本的属性以及作用在这些属性上
的功能。举个简单的例子：人为一个对象，有基本属性（身高、体重等），以及功能
（吃饭、说话等）。在面向对象的软件开发方法中，有三大特性：继承、封装及多态。今天
的主角是继承。</p>

<h3 id="何为继承">何为继承</h3>

<p>每个对象的可以抽象为不同的级别，我们将有某些共同属性或功能抽象成一个基类对象，然
后让派生类来继续延用（继承）公用的属性或功能。同样举个简单例子：父亲是一个基类或
父类，小孩就是派生类或子类，小孩会继承父亲遗传的某些性状（如血型）。</p>

<p>继承是实现代码重用的重要手段，直接使用基类对象的属性和方法，呈现面向对象程序设计
的层次结构，体现由简单到复杂、一般到特殊的认知过程。继承的方式有三种： <code>public</code> 继承、
 <code>protected</code> 继承、 <code>private</code> 继承。编译器通过三种方式对应的限定符进行区分。</p>

<h2 id="public-继承">public 继承</h2>

<p>公有继承是比较常见的继承方式，通过 <code>public</code> 关键字来表明。</p>

<h3 id="public-继承权限">public 继承权限</h3>

<ul>
<li>父类的 <code>public</code> 成员继承为子类的 <code>public</code> 成员，子类可以访问。</li>
<li>父类的 <code>protected</code> 成员继承为子类的 <code>protected</code> 成员，子类成员函数可以访问。</li>
<li>父类的 <code>private</code> 成员仍为 <strong>父类</strong> 的 <code>private</code> 成员，子类不可以访问。</li>
</ul>

<h3 id="实例">实例</h3>

<pre><code class="language-C++">#include &lt;iostream&gt;

class Base {
 public:
  int int_pub = 0;

 protected:
  int int_pro = 0;

 private:
  int int_pri = 0;
};

class Derive : public Base {
 public:
  void print() {
    std::cout &lt;&lt; &quot;print:&quot; &lt;&lt; int_pub &lt;&lt; std::endl;
    std::cout &lt;&lt; &quot;print:&quot; &lt;&lt; int_pro &lt;&lt; std::endl;
    // std::cout &lt;&lt; &quot;print:&quot; &lt;&lt; int_pri &lt;&lt; std::endl;
  }
};

int main() {
  Derive d;
  std::cout &lt;&lt; &quot;main:&quot; &lt;&lt; d.int_pub &lt;&lt; std::endl;
  // std::cout &lt;&lt; &quot;main:&quot; &lt;&lt; d.int_pro &lt;&lt; std::endl;
  d.print();
  return 0;
}
</code></pre>

<p>在子类的成员函数种访问父类的 <code>private</code> 会出错，错误信息也会提示这是 <code>Base</code> 的私
有成员。子类直接访问继承的 <code>protected</code> 成员也会报错。</p>

<h2 id="protected-继承">protected 继承</h2>

<p>保护继承通过 <code>protected</code> 关键字限定表明。</p>

<h3 id="protected-继承权限">protected 继承权限</h3>

<ul>
<li>父类的 <code>public</code> 成员继承为子类的 <code>protected</code> 成员，可通过成员函数访问。</li>
<li>父类的 <code>protected</code> 成员继承为子类的 <code>protected</code> 成员，可通过成员函数访问。</li>
<li>父类的 <code>private</code> 成员仍为 <strong>父类</strong> 的 <code>private</code> 成员，子类不可以访问。</li>
</ul>

<h3 id="实例-1">实例</h3>

<pre><code class="language-C++">#include &lt;iostream&gt;

class Base {
 public:
  int int_pub = 0;

 protected:
  int int_pro = 0;

 private:
  int int_pri = 0;
};

class Derive : protected Base {
 public:
  void print() {
    std::cout &lt;&lt; &quot;print:&quot; &lt;&lt; int_pub &lt;&lt; std::endl;
    std::cout &lt;&lt; &quot;print:&quot; &lt;&lt; int_pro &lt;&lt; std::endl;
    // std::cout &lt;&lt; &quot;print:&quot; &lt;&lt; int_pri &lt;&lt; std::endl;
  }
};

int main() {
  Derive d;
  // std::cout &lt;&lt; &quot;main:&quot; &lt;&lt; d.int_pub &lt;&lt; std::endl;
  // std::cout &lt;&lt; &quot;main:&quot; &lt;&lt; d.int_pro &lt;&lt; std::endl;
  d.print();
  return 0;
}
</code></pre>

<p>通过对象直接访问继承自父类的 <code>public</code> 成员会出错。</p>

<h2 id="private-继承">private 继承</h2>

<p>私有继承通过 <code>private</code> 关键字限定表明。</p>

<h3 id="protected-继承权限-1">protected 继承权限</h3>

<ul>
<li>父类的 <code>public</code> 成员继承为子类的 <code>private</code> 成员，可通过成员函数访问。</li>
<li>父类的 <code>protected</code> 成员继承为子类的 <code>private</code> 成员，可通过成员函数访问。</li>
<li>父类的 <code>private</code> 成员仍为 <strong>父类</strong> 的 <code>private</code> 成员，子类不可以访问。</li>
</ul>

<h3 id="实例-2">实例</h3>

<pre><code class="language-C++">#include &lt;iostream&gt;

class Base {
 public:
  int int_pub = 0;

 protected:
  int int_pro = 0;

 private:
  int int_pri = 0;
};

class Derive : protected Base {
 public:
  void print() {
    std::cout &lt;&lt; &quot;print:&quot; &lt;&lt; int_pub &lt;&lt; std::endl;
    std::cout &lt;&lt; &quot;print:&quot; &lt;&lt; int_pro &lt;&lt; std::endl;
    // std::cout &lt;&lt; &quot;print:&quot; &lt;&lt; int_pri &lt;&lt; std::endl;
  }
};

int main() {
  Derive d;
  // std::cout &lt;&lt; &quot;main:&quot; &lt;&lt; d.int_pub &lt;&lt; std::endl;
  // std::cout &lt;&lt; &quot;main:&quot; &lt;&lt; d.int_pro &lt;&lt; std::endl;
  d.print();
  return 0;
}
</code></pre>

<p>访问和 <code>protected</code> 是一样。这里说明 <code>private</code> 和 <code>protected</code> 的异同：继承权限不
一样，前者不可继承后者可以；访问权限是一样的，都必须通过成员函数才能访问。</p>

<h2 id="虚继承">虚继承</h2>

<p>虚继承的出现是用来解决多继承的对象多次被继承带来的问题。普通继承在不同途径继承来
自同一基类的子孙类中存在多份拷贝。这将存在两个问题：其一，浪费存储空间；第二，存
在二义性问题，通常可以将派生类对象的地址赋值给基类对象，实现的具体方式是，将基类
指针指向继承类（继承类有基类的拷贝）中的基类对象的地址，但是多重继承可能存在一个
基类的多份拷贝，这就出现了二义性。</p>

<p>虚继承可以解决多种继承前面提到的两个问题：</p>

<p>虚继承底层实现原理与编译器相关，一般通过虚基类指针和虚基类表实现，每个虚继承的子
类都有一个虚基类指针（占用一个指针的存储空间，4字节）和虚基类表（不占用类对象的
存储空间）（需要强调的是，虚基类依旧会在子类里面存在拷贝，只是仅仅最多存在一份而
已，并不是不在子类里面了）；当虚继承的子类被当做父类继承时，虚基类指针也会被继承。</p>

<p>实际上，vbptr指的是虚基类表指针（virtual base table pointer），该指针指
向了一个虚基类表（virtual table），虚表中记录了虚基类与本类的偏移地址；通过
偏移地址，这样就找到了虚基类成员，而虚继承也不用像普通多继承那样维持着公共基类
（虚基类）的两份同样的拷贝，节省了存储空间。</p>

<p>在这里我们可以对比虚函数的实现原理：他们有相似之处，都利用了虚指针（均占用类的
存储空间）和虚表（均不占用类的存储空间）。</p>

<p>虚基类依旧存在继承类中，只占用存储空间；虚函数不占用存储空间。</p>

<p>虚基类表存储的是虚基类相对直接继承类的偏移；而虚函数表存储的是虚函数地址。</p>

<figure>
    <img src="/images/virtual_inherit.png"/> 
</figure>


<h3 id="实例-3">实例</h3>

<ul>
<li>普通继承</li>
</ul>

<pre><code class="language-C++">#include&lt;iostream&gt;
using namespace std;

class A  //大小为4
{
public:
	int a;
};
class B :public A  //大小为8，变量a,b共8字节
{
public:
	int b;
};
class C :public A //与B一样8
{
public:
	int c;
};
class D :public B, public C //大小为20,变量 2xa + b + c + d = 20
{
public:
	int d;
};

int main()
{
	A a;
	B b;
	C c;
	D d;
	cout &lt;&lt; &quot;A &quot; &lt;&lt; sizeof(a) &lt;&lt; endl;
	cout &lt;&lt; &quot;B &quot; &lt;&lt; sizeof(b) &lt;&lt; endl;
	cout &lt;&lt; &quot;C &quot; &lt;&lt; sizeof(c) &lt;&lt; endl;
	cout &lt;&lt; &quot;D &quot; &lt;&lt; sizeof(d) &lt;&lt; endl;
	return 0;
}

</code></pre>

<ul>
<li>虚继承</li>
</ul>

<pre><code class="language-C++">#include&lt;iostream&gt;
using namespace std;

class A  //大小为4
{
public:
	int a;
};
class B :virtual public A  //大小为16，变量a,b共8字节，虚基类表指针8
{
public:
	int b;
};
class C :virtual public A //与B一样16
{
public:
	int c;
};
class D :public B, public C
         //大小为40,变量a,b,c,d共16，B的虚基类指针8，C的虚基类指针8,D类的虚指针8
         //也可以这样算： B, C 一共 32, d占4字节，D虚指针8,一共44, 减去B,C重复的A，得 40
{
public:
	int d;
};

int main()
{
	A a;
	B b;
	C c;
	D d;
	cout &lt;&lt; &quot;A &quot; &lt;&lt; sizeof(a) &lt;&lt; endl;
	cout &lt;&lt; &quot;B &quot; &lt;&lt; sizeof(b) &lt;&lt; endl;
	cout &lt;&lt; &quot;C &quot; &lt;&lt; sizeof(c) &lt;&lt; endl;
	cout &lt;&lt; &quot;D &quot; &lt;&lt; sizeof(d) &lt;&lt; endl;
	return 0;
}
</code></pre>

<p>从上面的两个例子中可以看出，在普通继承中的通过不同途径继承自同一继承祖先类的子孙
类中包含多份拷贝，在大型的软件系统中，这很浪费资源。</p>

<h3 id="虚继承与虚函数">虚继承与虚函数</h3>

<p>这两者是完全不同的概念，虚继承是解决多重继承带来的两个问题；而虚函数是为了实现多
态。</p>

<h2 id="总结">总结</h2>

<p>这篇是对面向对象三大特性之一进行简单的介绍，重点还是要理解继承权限的关系以及虚继
承和普通继承的内存布局，不要把虚继承和虚函数的弄混淆。</p>
</div>

  <footer class="article-footer">
    
    
    
    <section class="bordered">
      <header>
        <div class="panel-title">CATEGORIES</div>
      </header>
      <div>
        <ul class="p-terms">
          
          <li><a href="/categories/%E6%B8%A9%E6%95%85%E7%9F%A5%E6%96%B0/">温故知新</a></li>
          
        </ul>
      </div>
    </section>
    
    
    
    <section class="bordered">
      <header>
        <div class="panel-title">TAGS</div>
      </header>
      <div>
        <ul class="p-terms">
          
          <li><a href="/tags/c&#43;&#43;/">c&#43;&#43;</a></li>
          
          <li><a href="/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/">面向对象</a></li>
          
          <li><a href="/tags/%E7%BB%A7%E6%89%BF/">继承</a></li>
          
        </ul>
      </div>
    </section>
    
    
  </footer>

</article>


    
  </div>

  <div class="col-md-4">
    
<aside class="l-sidebar">

  <section class="panel panel-default">
    <div class="panel-heading">
      <div class="panel-title">LATESTS</div>
    </div>
    <div class="list-group">
      
      <a href="/post/the_art_of_command_03/" class="list-group-item">命令行艺术(3) ~~ 文件及数据处理篇</a>
      
      <a href="/post/the_art_of_command_02/" class="list-group-item">命令行艺术 (2) ~~ 日常使用篇</a>
      
      <a href="/post/the_art_of_command_01/" class="list-group-item">命令行艺术 (1) ~~ 基础篇</a>
      
      <a href="/post/about_cpp_inherits/" class="list-group-item">关于对象那些事儿 ~~ 继承</a>
      
      <a href="/post/write_textor_4/" class="list-group-item">动手写编辑器（四） ~ 文本编辑器</a>
      
      <a href="/post/write_textor_3/" class="list-group-item">动手写编辑器 (三) ~ 文件查看器</a>
      
      <a href="/post/write_textor_2/" class="list-group-item">动手写编辑器（二） ~ 输入和输出</a>
      
      <a href="/post/write_textor_1/" class="list-group-item">动手写编辑器(一) ~ 文本模式</a>
      
      <a href="/post/writh_shell_with_cpp/" class="list-group-item">手把手实现一个 Linux shell</a>
      
      <a href="/post/data_struct_trees_conclusion/" class="list-group-item">树结构及其应用场景总结</a>
      
    </div>
  </section>

  
  <section class="panel panel-default">
    <div class="panel-heading">
      <div class="panel-title">CATEGORY</div>
    </div>
    <div class="list-group">
      
      <a href="/categories/%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98" class="list-group-item">项目实战</a>
      
      <a href="/categories/%E5%91%BD%E4%BB%A4%E8%A1%8C%E8%89%BA%E6%9C%AF" class="list-group-item">命令行艺术</a>
      
      <a href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F" class="list-group-item">操作系统</a>
      
      <a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84" class="list-group-item">数据结构</a>
      
      <a href="/categories/%E6%B8%A9%E6%95%85%E7%9F%A5%E6%96%B0" class="list-group-item">温故知新</a>
      
    </div>
  </section>
  
  <section class="panel panel-default">
    <div class="panel-heading">
      <div class="panel-title">TAG</div>
    </div>
    <div class="list-group">
      
      <a href="/tags/c&#43;&#43;" class="list-group-item">c&#43;&#43;</a>
      
      <a href="/tags/terminal" class="list-group-item">terminal</a>
      
      <a href="/tags/linux" class="list-group-item">linux</a>
      
      <a href="/tags/shell" class="list-group-item">shell</a>
      
      <a href="/tags/command" class="list-group-item">command</a>
      
      <a href="/tags/textor" class="list-group-item">textor</a>
      
      <a href="/tags/conclusion" class="list-group-item">conclusion</a>
      
      <a href="/tags/data_struct" class="list-group-item">data_struct</a>
      
      <a href="/tags/funny" class="list-group-item">funny</a>
      
      <a href="/tags/gentoo" class="list-group-item">gentoo</a>
      
    </div>
  </section>
  

</aside>


  </div>
</div>

      </div>
    </main>

    <footer class="l-footer">
      <div class="container">
        <p><span class="h-logo">&copy; 北极狼徒</span></p>
        <aside>
          <p>Powered by <a href="https://gohugo.io/">Hugo</a>.</p>
          <p><a href="https://github.com/dim0627/hugo_theme_beg">Beg</a> designed by <a href="http://yet.unresolved.xyz/">Daisuke Tsuji</a>.</p>
        </aside>
      </div>
    </footer>

    <script src="//code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

